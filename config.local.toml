# Local Development Configuration
# This configuration is optimized for local development with verbose logging and relaxed security
# Copy this file to config.toml and customize as needed: cp config.local.toml config.toml

[server]
# Use 0.0.0.0 to be accessible from Caddy container
host = "0.0.0.0"
port = 3000
# Optional: Base URL for OAuth metadata and redirects
# If not set, will auto-construct from host and port (e.g., http://localhost:3000)
# base_url = "http://localhost:3000"
# Short timeout for quick feedback during development
request_timeout_secs = 5
# Keep-alive timeout in seconds
keep_alive_timeout_secs = 60
# Maximum concurrent connections
max_connections = 1000
# Enable graceful shutdown
graceful_shutdown = true
# Shutdown timeout in seconds
shutdown_timeout_secs = 30

[logging]
# Verbose logging for development debugging
level = "debug"
# Log format (json, pretty, compact)
format = "pretty"
# Enable file logging
file_enabled = true
# Log file path
file_path = "./logs/aiwebengine-dev.log"
# Log file rotation size in MB
file_max_size_mb = 100
# Number of rotated log files to keep
file_max_files = 10
# Enable console logging
console_enabled = true

[javascript]
# Short execution timeout for quick feedback (milliseconds)
execution_timeout_ms = 1000
# Small memory limit for development testing (bytes)
max_memory_bytes = 16777216  # 16 MB
# Maximum concurrent script executions
max_concurrent_executions = 50
# Enable script compilation caching
enable_compilation_cache = true
# Maximum number of cached compiled scripts
max_cached_scripts = 500
# Script execution stack size (bytes)
stack_size_bytes = 65536
# Enable script init() function calls
enable_init_functions = true
# Init function timeout in milliseconds (defaults to execution_timeout_ms if not set)
# init_timeout_ms = 2000
# Fail server startup if any script init fails
fail_startup_on_init_error = false

[repository]
# Use PostgreSQL for development (same as production/staging)
storage_type = "postgresql"
# Database URL is set via environment variable: APP_REPOSITORY__DATABASE_URL
# The double underscore __ maps to the nested config: repository.database_url
# Set in .env file or export directly: export APP_REPOSITORY__DATABASE_URL="postgresql://..."
# database_url is set via environment variable

# Maximum script size in bytes (1 MB)
max_script_size_bytes = 1048576
# Maximum asset size in bytes (10 MB)
max_asset_size_bytes = 10485760
# Maximum upload file size in bytes (10 MB)
max_upload_size_bytes = 10485760
# Maximum number of log messages per script
max_log_messages_per_script = 100
# Log message retention time in hours
log_retention_hours = 24
# Enable automatic log pruning
auto_prune_logs = true

[security]
# Relaxed security for development
enable_cors = true
# Allow all origins in development
cors_allowed_origins = ["*"]
# CSRF protection (disabled in development)
enable_csrf = false
# Optional: base64-encoded 32-byte CSRF key (set via APP_SECURITY__CSRF_KEY)
# csrf_key = "${APP_SECURITY__CSRF_KEY}"
# Rate limiting (disabled in development for testing)
enable_rate_limiting = false
rate_limit_per_minute = 0
# Security headers
enable_security_headers = true
# Content Security Policy
content_security_policy = "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'"
# Request validation
enable_request_validation = true
# Maximum request body size in bytes (1 MB)
max_request_body_bytes = 1048576
# Optional: base64-encoded 32-byte session encryption key (set via APP_SECURITY__SESSION_ENCRYPTION_KEY)
# session_encryption_key = "${APP_SECURITY__SESSION_ENCRYPTION_KEY}"
# Optional: API key for machine-to-machine authentication (override with APP_SECURITY__API_KEY env var)
api_key = "dev-api-key-12345"

[performance]
# No compression in development for easier debugging
enable_compression = false
# Compression level (1-9)
compression_level = 6
# Response caching (disabled in development)
enable_response_cache = false
# Response cache TTL in seconds
response_cache_ttl_secs = 60
# Maximum number of cached responses
max_cached_responses = 100
# Worker thread pool size (None = use Tokio default)
# worker_threads = 2
# Enable metrics collection
enable_metrics = true
# Metrics collection interval in seconds
metrics_interval_secs = 60

# Authentication Configuration
[auth]
# Enable authentication in development
enabled = true

# JWT secret for session management (minimum 32 characters)
# Override with APP_AUTH_JWT_SECRET environment variable
# For production, ALWAYS use environment variables!
jwt_secret = "dev-jwt-secret-minimum-32-characters-required-for-security"

# Session timeout in seconds (1 hour)
session_timeout = 3600

# Maximum concurrent sessions per user
max_concurrent_sessions = 10

# Bootstrap admin emails
# Users with these emails will automatically receive Administrator role on first sign-in
# This allows you to bootstrap the system with an initial admin who can then
# grant roles to other users through the /engine/admin UI
#
# FOR LOCAL DEVELOPMENT: Add your own email here
# Example: bootstrap_admins = ["your-email@gmail.com", "another@example.com"]
#
# Note: To set via environment variable, use JSON array format:
# export APP_AUTH_BOOTSTRAP_ADMINS='["your-email@gmail.com"]'
bootstrap_admins = [
    "admin@example.com",
]

[auth.cookie]
# Cookie settings for development
name = "aiwebengine_session"
path = "/"
secure = false  # Set to true in production with HTTPS
http_only = true
same_site = "lax"

# OAuth Providers Configuration
# Configure at least one provider to enable authentication
# Set secrets via environment variables (see .env.example):
#   APP_AUTH_PROVIDERS_GOOGLE_CLIENT_ID
#   APP_AUTH_PROVIDERS_GOOGLE_CLIENT_SECRET
#   APP_AUTH_PROVIDERS_GOOGLE_REDIRECT_URI

[auth.providers.google]
client_id = "${APP_AUTH_PROVIDERS_GOOGLE_CLIENT_ID}"
client_secret = "${APP_AUTH_PROVIDERS_GOOGLE_CLIENT_SECRET}"
redirect_uri = "http://localhost:3000/auth/callback/google"
scopes = ["openid", "email", "profile"]

# Microsoft Azure AD (values overridden by environment variables)
[auth.providers.microsoft]
client_id = "placeholder"
client_secret = "placeholder"
redirect_uri = "http://localhost:3000/auth/callback/microsoft"
tenant_id = "common"
scopes = ["openid", "email", "profile", "User.Read"]

# Optional: Apple Sign In
# Uncomment and set via environment variables to enable
# [auth.providers.apple]
# client_id = "${APP_AUTH_PROVIDERS_APPLE_CLIENT_ID}"
# client_secret = "${APP_AUTH_PROVIDERS_APPLE_CLIENT_SECRET}"
# redirect_uri = "http://localhost:3000/auth/callback/apple"
# team_id = "${APP_AUTH_PROVIDERS_APPLE_TEAM_ID}"
# key_id = "${APP_AUTH_PROVIDERS_APPLE_KEY_ID}"
# private_key = """${APP_AUTH_PROVIDERS_APPLE_PRIVATE_KEY}"""

# Secrets Configuration
# Store secret identifiers and values
# Environment variables prefixed with SECRET_ will also be loaded automatically
# Values can reference environment variables using ${VAR_NAME} syntax
[secrets]
# Example secrets (use environment variables in production):
# anthropic_api_key = "${ANTHROPIC_API_KEY}"
# sendgrid_api_key = "${SENDGRID_API_KEY}"

