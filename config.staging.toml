# Staging Configuration  
# This configuration bridges development and production for testing
# Copy this file to config.toml for staging deployments: cp config.staging.toml config.toml
# Set secrets via environment variables (see .env.example)

[server]
host = "0.0.0.0"
port = 8080
request_timeout_ms = 15000
max_body_size_mb = 5

[logging]
# Info level for staging debugging
level = "info"
structured = true
targets = ["console", "file"]
file_path = "./logs/aiwebengine-staging.log"
rotation = "daily"
retention_days = 14

[javascript]
max_memory_mb = 64
execution_timeout_ms = 5000
max_stack_size = 131072
# Allow console in staging for debugging
enable_console = true
# Full API access in staging for testing
allowed_apis = ["fetch", "database", "logging", "filesystem"]

[repository]
database_type = "postgresql"
# Set via APP_REPOSITORY_DATABASE_URL environment variable
database_url = "${APP_REPOSITORY_DATABASE_URL}"
max_connections = 20
connection_timeout_ms = 5000
# Allow auto-migrate in staging for testing
auto_migrate = true

[security]
enable_cors = true
# Allow staging and development origins
cors_origins = ["https://staging.yourdomain.com", "http://localhost:3000"]
# Moderate rate limiting for staging
rate_limit_per_minute = 500
# Set via APP_SECURITY_API_KEY environment variable
api_key = "${APP_SECURITY_API_KEY}"
# HTTPS preferred but not required in staging
require_https = false
allowed_content_types = ["application/json", "application/x-www-form-urlencoded", "multipart/form-data"]

[performance]
cache_size_mb = 128
cache_ttl_seconds = 1800
enable_compression = true
worker_pool_size = 4
max_request_queue_size = 200

# Authentication Configuration
[auth]
# Enable authentication in staging
enabled = true

# JWT secret for session management (minimum 32 characters)
# MUST be set via APP_AUTH_JWT_SECRET environment variable
jwt_secret = "${APP_AUTH_JWT_SECRET}"

# Session timeout in seconds (1 hour)
session_timeout = 3600

# Maximum concurrent sessions per user
max_concurrent_sessions = 5

# Bootstrap admin emails for staging environment
# Set via APP_AUTH_BOOTSTRAP_ADMINS environment variable (comma-separated)
bootstrap_admins = []

[auth.cookie]
name = "aiwebengine_session"
path = "/"
# Use secure cookies in staging if HTTPS is available
secure = true
http_only = true
same_site = "lax"

# OAuth Providers Configuration
# All secrets MUST be set via environment variables

[auth.providers.google]
client_id = "${APP_AUTH_PROVIDERS_GOOGLE_CLIENT_ID}"
client_secret = "${APP_AUTH_PROVIDERS_GOOGLE_CLIENT_SECRET}"
redirect_uri = "${APP_AUTH_PROVIDERS_GOOGLE_REDIRECT_URI}"
scopes = ["openid", "email", "profile"]

# Optional: Microsoft Azure AD
# [auth.providers.microsoft]
# client_id = "${APP_AUTH_PROVIDERS_MICROSOFT_CLIENT_ID}"
# client_secret = "${APP_AUTH_PROVIDERS_MICROSOFT_CLIENT_SECRET}"
# redirect_uri = "${APP_AUTH_PROVIDERS_MICROSOFT_REDIRECT_URI}"
# tenant_id = "${APP_AUTH_PROVIDERS_MICROSOFT_TENANT_ID}"
# scopes = ["openid", "email", "profile", "User.Read"]